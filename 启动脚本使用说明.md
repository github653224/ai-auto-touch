# 启动脚本使用说明

## 概述

项目提供了多个启动脚本，方便快速启动前后端服务。

## 脚本列表

### 1. 一键启动脚本 (推荐)

**文件**: `start_all.sh`  
**平台**: macOS / Linux  
**功能**: 交互式菜单，支持多种启动模式

#### 使用方法

```bash
bash start_all.sh
```

#### 启动选项

```
请选择启动模式：

  1) 启动后端服务 (FastAPI)
  2) 启动前端服务 (React)
  3) 同时启动前后端 (推荐)
  4) 启动 AI 模型服务 (vLLM)
  5) 全部启动 (模型 + 后端 + 前端)
  0) 退出
```

#### 特性

- ✅ 自动检测环境（Python、Node.js、ADB）
- ✅ 自动在新终端窗口启动服务
- ✅ 彩色输出，易于识别
- ✅ 错误提示和警告
- ✅ 支持 macOS 和 Linux

### 2. 前端启动脚本

#### macOS / Linux

**文件**: `frontend/start_frontend.sh`

```bash
cd frontend
bash start_frontend.sh
```

#### Windows

**文件**: `frontend/start_frontend.bat`

```cmd
cd frontend
start_frontend.bat
```

#### 特性

- ✅ 自动检测 Node.js
- ✅ 首次运行自动安装依赖
- ✅ 显示访问地址（本地 + 网络）
- ✅ 使用 `--host` 参数，支持局域网访问
- ✅ 端口 3002，避免冲突
- ✅ 禁用清屏，保留日志

#### 访问地址

- 本地: http://localhost:3002
- 网络: http://你的IP:3002

### 3. 后端启动脚本

**文件**: `backend/start_backend.sh`

```bash
cd backend
bash start_backend.sh
```

#### 特性

- ✅ 自动激活 conda 环境
- ✅ 自动检测依赖
- ✅ 显示 API 文档地址
- ✅ 热重载支持

#### 访问地址

- API: http://localhost:8001
- 文档: http://localhost:8001/docs

### 4. AI 模型启动脚本

**文件**: `backend/start_model.sh`

```bash
cd backend
bash start_model.sh
```

#### 特性

- ✅ 使用 vLLM 启动模型
- ✅ 自动检测模型文件
- ✅ 优化参数配置
- ✅ 支持多模态输入

#### 访问地址

- API: http://localhost:8000
- 模型列表: http://localhost:8000/v1/models

## 使用场景

### 场景 1: 开发调试（推荐）

使用一键启动脚本，选择"同时启动前后端"：

```bash
bash start_all.sh
# 选择 3
```

这会在两个新终端窗口中分别启动前后端，方便查看日志。

### 场景 2: 仅开发前端

```bash
cd frontend
bash start_frontend.sh
```

后端使用已启动的服务或远程 API。

### 场景 3: 仅开发后端

```bash
cd backend
bash start_backend.sh
```

前端使用已构建的静态文件或另一个开发服务器。

### 场景 4: 完整部署

使用一键启动脚本，选择"全部启动"：

```bash
bash start_all.sh
# 选择 5
```

这会启动 AI 模型、后端、前端三个服务。

### 场景 5: 局域网访问

启动前端时使用 `--host` 参数（脚本已包含）：

```bash
cd frontend
bash start_frontend.sh
```

然后在局域网内其他设备上访问：`http://服务器IP:3002`

## 端口说明

| 服务 | 端口 | 说明 |
|------|------|------|
| AI 模型 | 8000 | vLLM OpenAI 兼容 API |
| 后端 API | 8001 | FastAPI 服务 |
| 前端 | 3002 | React 开发服务器 |
| Socket.IO | 8001 | 视频流 WebSocket |

## 环境要求

### 必需

- **Python**: 3.8 - 3.11
- **Node.js**: 14 - 18
- **ADB**: Android Debug Bridge

### 可选

- **GPU**: NVIDIA GPU（用于本地 AI 模型）
- **vLLM**: 用于本地模型推理

## 常见问题

### Q1: 脚本无法执行

**问题**: `Permission denied`

**解决**:
```bash
chmod +x start_all.sh
chmod +x frontend/start_frontend.sh
chmod +x backend/start_backend.sh
```

### Q2: 端口被占用

**问题**: `Address already in use`

**解决**:
```bash
# 查找占用端口的进程
lsof -i :3002  # 前端
lsof -i :8001  # 后端
lsof -i :8000  # AI 模型

# 杀死进程
kill -9 <PID>
```

### Q3: Node.js 未找到

**问题**: `node: command not found`

**解决**:
1. 安装 Node.js: https://nodejs.org/
2. 或使用 nvm: `nvm install 16`

### Q4: Python 环境问题

**问题**: `conda: command not found`

**解决**:
1. 安装 Anaconda 或 Miniconda
2. 或使用 venv: `python -m venv venv`

### Q5: 无法在新窗口启动

**问题**: macOS 上无法自动打开新终端

**解决**:
手动在不同终端窗口中运行：
```bash
# 终端 1
cd backend && bash start_backend.sh

# 终端 2
cd frontend && bash start_frontend.sh
```

### Q6: Windows 脚本乱码

**问题**: Windows 命令行显示乱码

**解决**:
```cmd
chcp 65001
```

脚本已自动包含此命令。

## 停止服务

### 方法 1: Ctrl+C

在运行脚本的终端中按 `Ctrl+C`

### 方法 2: 杀死进程

```bash
# 查找进程
ps aux | grep "uvicorn\|vite"

# 杀死进程
kill -9 <PID>
```

### 方法 3: 杀死所有相关进程

```bash
# 停止后端
pkill -f uvicorn

# 停止前端
pkill -f vite

# 停止 AI 模型
pkill -f vllm
```

## 日志查看

### 前端日志

前端日志直接显示在终端中，包括：
- 编译信息
- 热更新信息
- 错误和警告

### 后端日志

后端日志显示在终端中，包括：
- API 请求日志
- 错误和异常
- 设备连接状态

### AI 模型日志

模型日志显示在终端中，包括：
- 模型加载信息
- 推理请求
- 性能统计

## 自定义配置

### 修改前端端口

编辑 `frontend/start_frontend.sh`:
```bash
npm run dev -- --host --port 3003 --clearScreen false
```

### 修改后端端口

编辑 `backend/.env`:
```
PORT=8002
```

### 修改 AI 模型端口

编辑 `backend/start_model.sh`:
```bash
--port 8080
```

## 生产部署

生产环境不建议使用这些开发脚本，请使用：

### 前端

```bash
cd frontend
npm run build
# 使用 nginx 或其他 Web 服务器托管 dist 目录
```

### 后端

```bash
cd backend
gunicorn main:app -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8001
```

### AI 模型

```bash
python -m vllm.entrypoints.openai.api_server \
  --model ./models/AutoGLM-Phone-9B \
  --port 8000 \
  --host 0.0.0.0
```

## 更新日志

### 2026-01-03

- ✅ 添加前端启动脚本（macOS/Linux/Windows）
- ✅ 添加一键启动脚本
- ✅ 支持交互式菜单
- ✅ 自动在新终端窗口启动
- ✅ 前端默认端口改为 3002
- ✅ 支持 --host 参数，局域网访问

## 反馈

如有问题或建议，请提交 Issue 或 Pull Request。

---

**文档版本**: 1.0  
**更新时间**: 2026-01-03  
**维护者**: AI Auto Touch Team
