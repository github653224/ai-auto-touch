# 服务启动说明

## 🚀 推荐启动方式（分别启动，便于查看日志）

为了便于查看日志和调试，建议在**不同的终端窗口**分别启动各个服务：

### 终端1 - AI模型服务（8000端口）

```bash
cd backend
./start_model.sh
```

**说明：**
- 前台运行，所有日志直接显示在终端
- 使用 vLLM（如果已安装）或本地模型服务
- 启动可能需要较长时间，请耐心等待
- 按 `Ctrl+C` 停止服务

### 终端2 - 后端主服务（8001端口）

```bash
cd backend
./start_backend.sh
```

**说明：**
- 前台运行，所有日志直接显示在终端
- 自动检测AI模型服务是否已启动
- 支持热重载（代码修改后自动重启）
- 按 `Ctrl+C` 停止服务

### 终端3 - 前端服务（3000端口）

```bash
cd frontend
npm run dev
```

**说明：**
- 前端开发服务器
- 支持热重载
- 按 `Ctrl+C` 停止服务

---

## 📋 启动脚本说明

### 独立启动脚本（推荐）

| 脚本 | 说明 | 端口 | 日志输出 |
|------|------|------|----------|
| `start_model.sh` | AI模型服务 | 8000 | 前台显示 |
| `start_backend.sh` | 后端主服务 | 8001 | 前台显示 |

### 其他脚本

| 脚本 | 说明 |
|------|------|
| `start_all.sh` | 显示启动指南和检查服务状态 |
| `stop_all.sh` | 停止所有服务 |
| `start_vllm.sh` | vLLM服务（后台运行，日志到文件） |
| `start_local_model.sh` | 本地模型服务（后台运行，日志到文件） |

---

## ⚡ 快速启动

### 方式1：分别启动（推荐）

```bash
# 终端1
cd backend && ./start_model.sh

# 终端2
cd backend && ./start_backend.sh

# 终端3
cd frontend && npm run dev
```

### 方式2：查看启动指南

```bash
cd backend
./start_all.sh
```

---

## 🔍 检查服务状态

```bash
# 检查所有服务端口
lsof -i :8000  # AI模型服务
lsof -i :8001  # 后端主服务
lsof -i :3000  # 前端服务

# 或使用启动指南脚本
./start_all.sh
```

---

## 🛑 停止服务

### 方式1：按 Ctrl+C
在运行服务的终端窗口按 `Ctrl+C`

### 方式2：使用停止脚本
```bash
cd backend
./stop_all.sh
```

### 方式3：手动停止
```bash
# 停止AI模型服务
lsof -ti :8000 | xargs kill

# 停止后端主服务
lsof -ti :8001 | xargs kill

# 停止前端服务
lsof -ti :3000 | xargs kill
```

---

## 💡 优势

### 分别启动的优势：

1. **日志可见**：所有日志直接显示在终端，便于调试
2. **独立控制**：可以单独重启某个服务，不影响其他服务
3. **节省时间**：模型服务启动慢，修复后端问题时不需要重启模型
4. **便于调试**：可以看到实时的错误信息和日志输出

### 示例场景：

- **修复后端代码**：只需重启 `start_backend.sh`，模型服务继续运行
- **查看模型日志**：直接在终端1查看，无需打开日志文件
- **调试前端**：只需重启前端，后端和模型服务继续运行

---

## 📝 注意事项

1. **启动顺序**：建议先启动AI模型服务，再启动后端主服务
2. **端口占用**：如果端口被占用，脚本会提示是否停止现有服务
3. **环境要求**：所有服务都需要在 `ai-auto-touch` conda环境中运行
4. **模型路径**：脚本会自动检测本地模型，优先使用本地模型

---

## 🐛 常见问题

### Q: 模型服务启动很慢？
A: 正常现象，vLLM首次启动需要加载模型，可能需要几分钟。

### Q: 如何查看后台运行的日志？
A: 如果使用后台运行（nohup），日志在 `logs/` 目录：
- `logs/vllm.log` - vLLM服务日志
- `logs/local_model.log` - 本地模型服务日志
- `logs/backend.log` - 后端主服务日志

### Q: 服务启动失败？
A: 检查：
1. conda环境是否激活
2. 端口是否被占用
3. 依赖是否安装完整
4. 查看终端错误信息

